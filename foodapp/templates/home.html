{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
{% load static %}

{% if not user.is_authenticated %}

<section class="section-with-image" 
style="background-image: 
    linear-gradient(
        rgba(0, 0, 0, 0.3), 
        rgba(0, 0, 0, 0.3)
        ),
        url('{% static 'images/background.jpg' %}')"> 
    
    
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8 text-center"> 
          <h1>Connecting food lovers with local home chefs.</h1>
          <p>Enjoy delicious, home-cooked meals delivered to your doorstep.</p>
          <p>Discover a variety of cuisines and find your new favorite home chef.</p>
          <a href="{% url 'register' %}" class="btn btn-success btn-lg">Register Now </a> 
        </div>
      </div>
    </div>
  </section>

{% endif %}


<section>
<div class="container">
    {% if messages %}
        <div class="alert-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <form method="GET" action="{% url 'home' %}" class="mb-4">
        <div class="input-group">
            <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Search for food..." class="form-control">
            <div class="input-group-append">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
        </div>

        <div class="form-row mt-3">
            <div class="col-md-4">
                <label for="cuisine">Cuisine:</label>
                <select name="cuisine" class="form-control">
                    <option value="">All</option>
                    {% for c in cuisines %}
                        <option value="{{ c }}" {% if request.GET.cuisine == c %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="city">City:</label>
                <select name="city" class="form-control">
                    <option value="">All</option>
                    {% for c in cities %}
                        <option value="{{ c }}" {% if request.GET.city == c %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="zipcode">Zip Code:</label>
                <select name="zipcode" class="form-control">
                    <option value="">All</option>
                    {% for z in zipcodes %}
                        <option value="{{ z }}" {% if request.GET.zipcode == z %}selected{% endif %}>{{ z }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="foodmaker">FoodMaker:</label>
                <select name="foodmaker" class="form-control">
                    <option value="">All</option>
                    {% for f in foodmakers %}
                        <option value="{{ f.id }}" {% if request.GET.foodmaker == f.id|slugify %}selected{% endif %}>{{ f.user.username }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-secondary mt-2">Filter</button>
    </form>

    <div class="row">
        {% for food in food_items %}
        <div class="col-md-4 mb-4">
            <div class="card">
                <img src="{{ food.food_image.url }}" class="card-img-top" alt="{{ food.title }}">
                <div class="card-body">
                    <h5 class="card-title">{{ food.title }}</h5>
                    <p class="card-text">{{ food.description|truncatewords:15 }}</p>
                    <p class="card-text"><strong>Price: ${{ food.price }}</strong></p>
                    <p class="card-text">
                        <strong>By:</strong> 
                        <a href="{% url 'foodmaker_profile' food.foodmaker.id %}">
                            {{ food.foodmaker.user.username }}
                        </a>
                    </p>
                    <a href="{% url 'food_detail' food.id %}" class="btn btn-info">View More</a>
                </div>
            </div>
        </div>
        {% empty %}
            <p>No food items available.</p>
        {% endfor %}
    </div>

</div>
</section>
{% endblock %}